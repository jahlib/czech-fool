<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>–ß–µ—à—Å–∫–∏–π</title>
    <!-- –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à WebSocket –¥–æ–º–µ–Ω –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ reverse proxy -->
    <!-- <meta name="ws-host" content="ws.domain.com"> -->
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="shortcut icon" href="/icon-192.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <link rel="stylesheet" href="/style.css?v=3">
</head>
<body>
    <div id="app">
        <!-- –≠–∫—Ä–∞–Ω –ª–æ–±–±–∏ -->
        <div id="lobby-screen" class="screen active">
            <div class="container">
                <h1>üé¥ –ß–µ—à—Å–∫–∏–π</h1>
                
                <div id="create-room-section">
                    <h2>–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</h2>
                    <input type="text" id="nickname-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º" maxlength="20">
                    <button id="create-room-btn" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
                    
                    <div id="bot-game-section">
                        <h3>ü§ñ –ò–≥—Ä–∞—Ç—å —Å –±–æ—Ç–∞–º–∏</h3>
                        <div class="bot-buttons">
                            <button id="play-with-1-bot-btn" class="btn btn-bot">–ò–≥—Ä–∞—Ç—å —Å 1 –±–æ—Ç–æ–º</button>
                            <button id="play-with-2-bots-btn" class="btn btn-bot">–ò–≥—Ä–∞—Ç—å —Å 2 –±–æ—Ç–∞–º–∏</button>
                            <button id="play-with-3-bots-btn" class="btn btn-bot">–ò–≥—Ä–∞—Ç—å —Å 3 –±–æ—Ç–∞–º–∏</button>
                        </div>
                    </div>
                </div>
                
                <div id="rooms-section">
                    <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã</h2>
                    <div id="rooms-list"></div>
                </div>
                
                <div id="rules-section">
                    <h2>üìñ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
                    <div id="lobby-rules-content" class="rules-content"></div>
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –∫–æ–º–Ω–∞—Ç—ã -->
        <div id="room-screen" class="screen">
            <div class="container">
                <div class="room-header">
                    <h2>–ö–æ–º–Ω–∞—Ç–∞</h2>
                    <button id="leave-room-btn" class="btn btn-secondary">–ü–æ–∫–∏–Ω—É—Ç—å</button>
                </div>
                
                <div id="players-waiting">
                    <h3>–ò–≥—Ä–æ–∫–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ:</h3>
                    <div id="players-list"></div>
                    
                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–Ω–∞—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è) -->
                    <div id="room-settings" style="display: none;">
                        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã</h3>
                        
                        <div class="deck-size-toggle">
                            <label>
                                <span class="deck-label">36 –∫–∞—Ä—Ç</span>
                                <input type="checkbox" id="deck-size-toggle" checked>
                                <span class="toggle-slider"></span>
                                <span class="deck-label">52 –∫–∞—Ä—Ç—ã</span>
                            </label>
                            <p class="hint-small">–í —Ä–µ–∂–∏–º–µ 36 –∫–∞—Ä—Ç –≤–æ—Å—å–º—ë—Ä–∫–∞ –Ω–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç</p>
                        </div>
                    </div>
                    
                    <div id="countdown-display" style="display: none;">
                        <div class="countdown-timer">
                            <span id="countdown-number">6</span>
                        </div>
                        <p class="countdown-text">–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...</p>
                    </div>
                    <button id="ready-toggle-btn" class="btn btn-primary">–ì–æ—Ç–æ–≤</button>
                    <p class="hint">–ò–≥—Ä–∞ –Ω–∞—á–Ω—ë—Ç—Å—è –∫–æ–≥–¥–∞ –≤—Å–µ –∏–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –≥–æ—Ç–æ–≤—ã (–º–∏–Ω–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞)</p>

                    <div class="room-settings" id="private-room-settings">
                        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø—Ä–∏–≤–∞—Ç–Ω–æ–π –∫–æ–º–Ω–∞—Ç—ã -->
                        <div class="deck-size-toggle">
                            <label>
                                <span class="deck-label">–ü—É–±–ª–∏—á–Ω–∞—è</span>
                                <input type="checkbox" id="private-room-toggle">
                                <span class="toggle-slider"></span>
                                <span class="deck-label">–ü—Ä–∏–≤–∞—Ç–Ω–∞—è</span>
                            </label>
                        </div>
                        
                        <!-- –ë–ª–æ–∫ —Å —Å—Å—ã–ª–∫–æ–π –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                        <div id="invite-link-block" style="display: none;">
                            <p class="invite-hint">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏:</p>
                            <div class="invite-link-container">
                                <code id="invite-link" class="invite-link"></code>
                                <button id="copy-link-btn" class="btn btn-copy" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
<path fill-rule="evenodd" clip-rule="evenodd" d="M15 1.25H10.9436C9.10583 1.24998 7.65019 1.24997 6.51098 1.40314C5.33856 1.56076 4.38961 1.89288 3.64124 2.64124C2.89288 3.38961 2.56076 4.33856 2.40314 5.51098C2.24997 6.65019 2.24998 8.10582 2.25 9.94357V16C2.25 17.8722 3.62205 19.424 5.41551 19.7047C5.55348 20.4687 5.81753 21.1208 6.34835 21.6517C6.95027 22.2536 7.70814 22.5125 8.60825 22.6335C9.47522 22.75 10.5775 22.75 11.9451 22.75H15.0549C16.4225 22.75 17.5248 22.75 18.3918 22.6335C19.2919 22.5125 20.0497 22.2536 20.6517 21.6517C21.2536 21.0497 21.5125 20.2919 21.6335 19.3918C21.75 18.5248 21.75 17.4225 21.75 16.0549V10.9451C21.75 9.57754 21.75 8.47522 21.6335 7.60825C21.5125 6.70814 21.2536 5.95027 20.6517 5.34835C20.1208 4.81753 19.4687 4.55348 18.7047 4.41551C18.424 2.62205 16.8722 1.25 15 1.25ZM17.1293 4.27117C16.8265 3.38623 15.9876 2.75 15 2.75H11C9.09318 2.75 7.73851 2.75159 6.71085 2.88976C5.70476 3.02502 5.12511 3.27869 4.7019 3.7019C4.27869 4.12511 4.02502 4.70476 3.88976 5.71085C3.75159 6.73851 3.75 8.09318 3.75 10V16C3.75 16.9876 4.38624 17.8265 5.27117 18.1293C5.24998 17.5194 5.24999 16.8297 5.25 16.0549V10.9451C5.24998 9.57754 5.24996 8.47522 5.36652 7.60825C5.48754 6.70814 5.74643 5.95027 6.34835 5.34835C6.95027 4.74643 7.70814 4.48754 8.60825 4.36652C9.47522 4.24996 10.5775 4.24998 11.9451 4.25H15.0549C15.8297 4.24999 16.5194 4.24998 17.1293 4.27117ZM7.40901 6.40901C7.68577 6.13225 8.07435 5.9518 8.80812 5.85315C9.56347 5.75159 10.5646 5.75 12 5.75H15C16.4354 5.75 17.4365 5.75159 18.1919 5.85315C18.9257 5.9518 19.3142 6.13225 19.591 6.40901C19.8678 6.68577 20.0482 7.07435 20.1469 7.80812C20.2484 8.56347 20.25 9.56458 20.25 11V16C20.25 17.4354 20.2484 18.4365 20.1469 19.1919C20.0482 19.9257 19.8678 20.3142 19.591 20.591C19.3142 20.8678 18.9257 21.0482 18.1919 21.1469C17.4365 21.2484 16.4354 21.25 15 21.25H12C10.5646 21.25 9.56347 21.2484 8.80812 21.1469C8.07435 21.0482 7.68577 20.8678 7.40901 20.591C7.13225 20.3142 6.9518 19.9257 6.85315 19.1919C6.75159 18.4365 6.75 17.4354 6.75 16V11C6.75 9.56458 6.75159 8.56347 6.85315 7.80812C6.9518 7.07435 7.13225 6.68577 7.40901 6.40901Z" fill="#FFFFFF"/>
</svg></button>
                                <button id="share-link-btn" class="btn btn-share" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" style="display: none;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
<path d="M12 1.25H11.9426C9.63423 1.24999 7.82519 1.24998 6.41371 1.43975C4.96897 1.63399 3.82895 2.03933 2.93414 2.93414C2.03933 3.82895 1.63399 4.96897 1.43975 6.41371C1.24998 7.82519 1.24999 9.63423 1.25 11.9426V12.0574C1.24999 14.3658 1.24998 16.1748 1.43975 17.5863C1.63399 19.031 2.03933 20.1711 2.93414 21.0659C3.82895 21.9607 4.96897 22.366 6.41371 22.5603C7.82519 22.75 9.63423 22.75 11.9426 22.75H12.0574C14.3658 22.75 16.1748 22.75 17.5863 22.5603C19.031 22.366 20.1711 21.9607 21.0659 21.0659C21.9607 20.1711 22.366 19.031 22.5603 17.5863C22.75 16.1748 22.75 14.3658 22.75 12.0574V12C22.75 11.5858 22.4142 11.25 22 11.25C21.5858 11.25 21.25 11.5858 21.25 12C21.25 14.3782 21.2484 16.0864 21.0736 17.3864C20.9018 18.6648 20.5749 19.4355 20.0052 20.0052C19.4355 20.5749 18.6648 20.9018 17.3864 21.0736C16.0864 21.2484 14.3782 21.25 12 21.25C9.62178 21.25 7.91356 21.2484 6.61358 21.0736C5.33517 20.9018 4.56445 20.5749 3.9948 20.0052C3.42514 19.4355 3.09825 18.6648 2.92637 17.3864C2.75159 16.0864 2.75 14.3782 2.75 12C2.75 9.62178 2.75159 7.91356 2.92637 6.61358C3.09825 5.33517 3.42514 4.56445 3.9948 3.9948C4.56445 3.42514 5.33517 3.09825 6.61358 2.92637C7.91356 2.75159 9.62178 2.75 12 2.75C12.4142 2.75 12.75 2.41421 12.75 2C12.75 1.58579 12.4142 1.25 12 1.25Z" fill="#FFFFFF"/>
<path d="M12.4697 10.4697C12.1768 10.7626 12.1768 11.2374 12.4697 11.5303C12.7626 11.8232 13.2374 11.8232 13.5303 11.5303L21.25 3.81066V7.34375C21.25 7.75796 21.5858 8.09375 22 8.09375C22.4142 8.09375 22.75 7.75796 22.75 7.34375V2C22.75 1.58579 22.4142 1.25 22 1.25H16.6562C16.242 1.25 15.9062 1.58579 15.9062 2C15.9062 2.41421 16.242 2.75 16.6562 2.75H20.1893L12.4697 10.4697Z" fill="#FFFFFF"/>
</svg></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ -->
        <div id="error-screen" class="screen">
            <div class="error-container">
                <div class="error-content">
                    <h1>üòï</h1>
                    <h2>–ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h2>
                    <p id="error-message">–≠—Ç–∞ –∫–æ–º–Ω–∞—Ç–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞</p>
                    <button id="go-home-btn" class="btn btn-primary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
        <div id="game-screen" class="screen">
            <div class="game-container">
                <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É -->
                <button id="leave-game-btn" class="leave-game-btn" title="–ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É">
                    <span class="leave-icon">üö™</span>
                </button>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
                <button id="settings-btn" class="settings-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–∞–≤–∏–ª -->
                <button id="rules-btn" class="rules-btn" title="–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã">üìñ</button>
                
                <!-- –ö–Ω–æ–ø–∫–∞ —á–∞—Ç–∞ -->
                <button id="chat-btn" class="chat-btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ">üí¨</button>
                
                <!-- –ö—Ä—É–≥–æ–≤–æ–µ –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
                <div class="game-table">
                    <!-- –ò–≥—Ä–æ–≤–æ–π –ª–æ–≥ -->
                    <div id="game-log" class="game-log"></div>
                    
                    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤ -->
                    <div id="opponents-container">
                        <!-- –ò–≥—Ä–æ–∫ —Å–ª–µ–≤–∞ -->
                        <div class="opponent-area opponent-left" id="opponent-left">
                            <div class="opponent-info">
                                <span class="opponent-name"></span>
                                <span class="opponent-score"></span>
                            </div>
                            <div class="opponent-cards"></div>
                        </div>
                        
                        <!-- –ò–≥—Ä–æ–∫ –ø–æ —Ü–µ–Ω—Ç—Ä—É -->
                        <div class="opponent-area opponent-top" id="opponent-top">
                            <div class="opponent-info">
                                <span class="opponent-name"></span>
                                <span class="opponent-score"></span>
                            </div>
                            <div class="opponent-cards"></div>
                        </div>
                        
                        <!-- –ò–≥—Ä–æ–∫ —Å–ø—Ä–∞–≤–∞ -->
                        <div class="opponent-area opponent-right" id="opponent-right">
                            <div class="opponent-info">
                                <span class="opponent-name"></span>
                                <span class="opponent-score"></span>
                            </div>
                            <div class="opponent-cards"></div>
                        </div>
                    </div>
                    
                    <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫—Ä—É–≥ —Å –∫–∞—Ä—Ç–æ–π –∏ –∫–æ–ª–æ–¥–æ–π -->
                    <div class="game-circle">
                        <div class="center-area">
                            <div class="center-card-wrapper">
                                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–∞—Å—Ç–∏ -->
                                <div id="chosen-suit-indicator" style="display: none;"></div>
                                <div id="discard-pile" class="center-card"></div>
                            </div>
                            <div class="deck-area">
                                <div class="deck-count-badge" id="deck-count">0</div>
                                <div id="deck" class="card-pile">
                                    <div class="card card-back">üé¥</div>
                                </div>
                                <div class="deck-buttons">
                                    <button id="draw-card-btn" class="btn btn-primary btn-sm">–í–∑—è—Ç—å</button>
                                    <button id="skip-turn-btn" class="btn btn-secondary btn-sm" style="display: none;">–ù–µ—Ç—É</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä–æ–∫–∞ -->
                    <div class="player-container">
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–æ–∫–µ -->
                        <div class="player-info">
                            <span class="player-name" id="player-name"></span>
                            <span class="player-score" id="player-score"></span>
                        </div>
                        
                        <!-- –ö–∞—Ä—Ç—ã –∏–≥—Ä–æ–∫–∞ –≤–Ω–∏–∑—É -->
                        <div class="player-hand">
                            <div id="hand-cards"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–∞—Ç–∞ -->
        <div id="chat-modal" class="modal">
            <div class="modal-content chat-modal-content">
                <h3>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
                <textarea id="chat-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." maxlength="200"></textarea>
                <div class="chat-modal-buttons">
                    <button id="send-chat-btn" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    <button id="close-chat-btn" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –º–∞—Å—Ç–∏ -->
        <div id="suit-modal" class="modal">
            <div class="modal-content">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç—å</h3>
                <div class="suit-selector">
                    <button class="suit-btn" data-suit="hearts">‚ô•Ô∏è –ß–µ—Ä–≤–∏</button>
                    <button class="suit-btn" data-suit="diamonds">‚ô¶Ô∏è –ë—É–±–Ω—ã</button>
                    <button class="suit-btn" data-suit="clubs">‚ô£Ô∏è –¢—Ä–µ—Ñ—ã</button>
                    <button class="suit-btn" data-suit="spades">‚ô†Ô∏è –ü–∏–∫–∏</button>
                </div>
                <div class="modal-buttons" style="margin-top: 15px;">
                    <button id="cancel-suit-btn" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div id="results-modal" class="modal">
            <div class="modal-content">
                <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
                <div id="results-content"></div>
                <button id="close-results-btn" class="btn btn-primary">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∫–æ–º–Ω–∞—Ç–µ -->
        <div id="join-modal" class="modal">
            <div class="modal-content">
                <h3>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ</h3>
                <input type="text" id="join-nickname-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º" maxlength="20">
                <div class="modal-buttons">
                    <button id="join-confirm-btn" class="btn btn-primary">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                    <button id="join-cancel-btn" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è -->
        <div id="alert-modal" class="modal">
            <div class="modal-content">
                <h3>–°–æ–æ–±—â–µ–Ω–∏–µ</h3>
                <p id="alert-text" style="margin: 10px 0 20px 0;"></p>
                <div class="modal-buttons">
                    <button id="alert-ok-btn" class="btn btn-primary">–û–ö</button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞ -->
        <div id="leave-confirm-modal" class="modal">
            <div class="modal-content">
                <h3>–ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É?</h3>
                <p style="margin: 10px 0 20px 0;">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å –∏–≥—Ä—É?</p>
                <div class="modal-buttons">
                    <button id="leave-confirm-btn" class="btn btn-primary">–î–∞, –≤—ã–π—Ç–∏</button>
                    <button id="leave-cancel-btn" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∞–≤–∏–ª -->
        <div id="rules-modal" class="modal">
            <div class="modal-content rules-modal-content">
                <button id="close-rules-btn" class="close-modal-btn">‚úï</button>
                <h2>üìñ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
                <div id="rules-content" class="rules-content"></div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settings-modal" class="modal">
            <div class="modal-content settings-modal-content">
                <button id="close-settings-btn" class="close-modal-btn">‚úï</button>
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <div class="settings-content">
                    <!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º -->
                    <div class="setting-item">
                        <span class="setting-label">–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º</span>
                        <div class="deck-size-toggle">
                            <label>
                                <span class="deck-label">–í—ã–∫–ª</span>
                                <input type="checkbox" id="fullscreen-toggle">
                                <span class="toggle-slider"></span>
                                <span class="deck-label">–í–∫–ª</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- –ó–≤—É–∫ -->
                    <div class="setting-item">
                        <span class="setting-label">–ó–≤—É–∫</span>
                        <div class="deck-size-toggle">
                            <label>
                                <span class="deck-label">–í—ã–∫–ª</span>
                                <input type="checkbox" id="sound-toggle" checked>
                                <span class="toggle-slider"></span>
                                <span class="deck-label">–í–∫–ª</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- –ê–Ω–∏–º–∞—Ü–∏–∏ -->
                    <div class="setting-item">
                        <span class="setting-label">–ê–Ω–∏–º–∞—Ü–∏–∏ –∫–∞—Ä—Ç</span>
                        <div class="deck-size-toggle">
                            <label>
                                <span class="deck-label">–í—ã–∫–ª</span>
                                <input type="checkbox" id="animations-toggle" checked>
                                <span class="toggle-slider"></span>
                                <span class="deck-label">–í–∫–ª</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- –†–µ–∂–∏–º –ü—Ä–æ -->
                    <div class="setting-item">
                        <span class="setting-label">–†–µ–∂–∏–º –ü—Ä–æ</span>
                        <div class="deck-size-toggle">
                            <label>
                                <span class="deck-label">–í—ã–∫–ª</span>
                                <input type="checkbox" id="pro-mode-toggle">
                                <span class="toggle-slider"></span>
                                <span class="deck-label">–í–∫–ª</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- –õ–æ–≥ (—Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
                    <div class="setting-item mobile-only">
                        <span class="setting-label">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–æ–≥</span>
                        <div class="deck-size-toggle">
                            <label>
                                <span class="deck-label">–í—ã–∫–ª</span>
                                <input type="checkbox" id="log-toggle" checked>
                                <span class="toggle-slider"></span>
                                <span class="deck-label">–í–∫–ª</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/marked.min.js?v=3"></script>
    <script src="/game.js?v=3"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed:', err);
                    });
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ - –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ª–æ–±–±–∏)
        function isOnLobbyScreen() {
            const lobbyScreen = document.getElementById('lobby-screen');
            return lobbyScreen && lobbyScreen.classList.contains('active');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ - –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ —Ä—É–∫–∏
        function isInsidePlayerHand(element) {
            while (element) {
                if (element.classList && element.classList.contains('player-hand')) {
                    return true;
                }
                element = element.parentElement;
            }
            return false;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ - –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        function isInsideScrollableModal(element) {
            while (element) {
                if (element.classList && (
                    element.classList.contains('rules-modal-content') ||
                    element.classList.contains('modal-content')
                )) {
                    return true;
                }
                element = element.parentElement;
            }
            return false;
        }
        
        // –û—Ç–∫–ª—é—á–∞–µ–º pull-to-refresh —Ç–æ–ª—å–∫–æ –ù–ï –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        let touchStartY = 0;
        document.addEventListener('touchstart', function(e) {
            touchStartY = e.touches[0].clientY;
        }, { passive: false });
        
        document.addEventListener('touchmove', function(e) {
            // –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ –∂–µ—Å—Ç—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if (isOnLobbyScreen()) {
                return;
            }
            
            // –†–∞–∑—Ä–µ—à–∞–µ–º —Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ —Ä—É–∫–∏ –∏–≥—Ä–æ–∫–∞
            if (isInsidePlayerHand(e.target)) {
                return;
            }
            
            // –†–∞–∑—Ä–µ—à–∞–µ–º —Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–æ–∫
            if (isInsideScrollableModal(e.target)) {
                return;
            }
            
            const touchY = e.touches[0].clientY;
            const touchDiff = touchY - touchStartY;
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—è–Ω–µ—Ç –≤–Ω–∏–∑ –Ω–∞ –≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã - –±–ª–æ–∫–∏—Ä—É–µ–º
            if (touchDiff > 0 && window.scrollY === 0) {
                e.preventDefault();
            }
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –º—É–ª—å—Ç–∏—Ç–∞—á
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // –û—Ç–∫–ª—é—á–∞–µ–º –¥–≤–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –¥–ª—è –∑—É–º–∞ —Ç–æ–ª—å–∫–æ –ù–ï –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            // –†–∞–∑—Ä–µ—à–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if (isOnLobbyScreen()) {
                return;
            }
            
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —á–µ—Ä–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Ç–æ–ª—å–∫–æ –ù–ï –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
        document.addEventListener('keydown', function(e) {
            // –†–∞–∑—Ä–µ—à–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if (isOnLobbyScreen()) {
                return;
            }
            
            if ((e.key === 'F5') || 
                (e.ctrlKey && e.key === 'r') || 
                (e.metaKey && e.key === 'r')) {
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>
